<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Space invaders</title>
    <script type="text/javascript" src="Engine/Engine.js"></script>
    <script type="text/javascript" src="Objects/Player.js"></script>
    <script type="text/javascript" src="Objects/Alien.js"></script>
</head>
<body>

<div id="game"></div>
<script type="text/javascript">
    var score = 0;
    var aliens = new Array();

    // Having to adres aliens is wierd this might be a bug on my part .. fixing later
    // it should the this .. instead of aliens...
    Array.prototype.Draw = () => {
        for (i = 0; i < aliens.length; i++) {
            var alien = aliens[i];
            alien.Draw();
        }
    }

    setupAlienGroup = (size) => {
        var alienWidth = 24;
        var alienHeight = 16;
        var alienRows = 3;
        var padding = 10; // 10 pixels left and 10 pixels right
        var alienIntialX = 40;

        // Lets calculate how many aliens we can store on the screen.
        // In this calculation we don't need the height we calculate based
        // on the width of the screen.

        var boundingbox = new Size(size.width - padding, 0);
        var spriteWidthIncPadding = alienWidth + padding;

        var lastAlienX = alienIntialX;
        var lastAlienY =  140;

        var amountPerRow = Math.round((boundingbox.width - padding - alienIntialX) / spriteWidthIncPadding);


        for (var row = 0; row < alienRows; row++) {
            for (var aliencnt = 0; aliencnt < amountPerRow; aliencnt++) {
                var alien = new Alien(lastAlienX, lastAlienY, alienWidth, alienHeight);
                aliens.push(alien);
                lastAlienX = alien.x + alien.w + padding;
            }
            lastAlienY += (alienHeight + padding);
            lastAlienX = alienIntialX
        }
    }

    drawAlienGroup = (size) => {
        // Or if we are gaming already lets draw them on the screen.
        aliens.Draw();
    }

    start = () => {

        var size = new Size(
            window.innerWidth - 20,
            window.innerHeight - 20,
        );

        setupEngine('game', size).then(function (screen) {
            Canvas().style.background = 'rgb(0,0,0)';

            var keyboard = new KeyboardInput();
            var mouse = new MouseInput();
            var player = new Player(size.width / 2 - 10, size.height - 10, 30, 16);
            var stepsize = 5;

            setupAlienGroup(size);

            setInterval(function () {
                screen.Clear();
                fill('white');

                var keyCode = keyboard.getKey();
                var mousedirection = mouse.getDirection();

                switch (mousedirection) {
                    case mouse.DIRECTON_LEFT:
                        player.velx = -stepsize;
                        player.vely = 0;
                        break;
                    case mouse.DIRECTON_RIGHT:
                        player.velx = stepsize;
                        player.vely = 0;
                        break;
                }

                switch (keyCode) {
                    case keyboard.KEY_LEFT:
                        player.velx = -stepsize;
                        player.vely = 0;
                        break;
                    case keyboard.KEY_RIGHT:
                        player.velx = stepsize;
                        player.vely = 0;
                        break;
                }

                if (mouse.didClick() == true || keyCode == keyboard.KEY_SPACEBAR) {
                    console.log(' Fire !!');
                }

                // Simple bounds check
                if (player.x <= 0) {
                    player.x = 0;
                }

                if (player.x >= (size.width - player.w)) {
                    player.x = size.width - player.w;
                }


                player.Draw();
                drawAlienGroup(size);
                text('Score: ' + score, 10, 27, 18);
            }, 33);
        });
    }

    start();

</script>
</body>
</html>